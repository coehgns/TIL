# VPC(Virtual Private Cloud)
VPC를 사용하지 않는다면 다음 사진처럼 여러 EC2 리소스들이 서로 거미줄처럼 연결되고 인터넷망과 연결되어있을 것입니다. 이러한 구조는 시스템적으로 복잡성이 올라가고, 인스텬스 리소스들이 서로 연결되어 있어, 하나의 인스턴스 수정 시 또 다른 인스턴스를 수정해야하는 불편함이 생길 수 있습니다.

<img width="755" alt="Image" src="https://github.com/user-attachments/assets/9899d8c3-4a83-43df-a115-63933531f040" />

이러한 불편함을 해소하기 위해서 VPC를 사용하게 됩니다.

<img width="750" alt="Image" src="https://github.com/user-attachments/assets/b93cf677-8a49-466b-b85d-7a130af69255" />

VPC를 사용하게 되면 위 그림처럼 각각의 VPC 별로 네트워크를 구성하고, 설정할 수 있습니다.

## VPC 구축 과정

- VPC를 구축하기 위해서는 VPC의 아이피 범위를 RFC1918라는 사설 아이피대역에 맞추어야합니다.

`사설 아이피`: 어떠한 네트워크 안에서 고정으로 사용되는 고유한 주소를 말합니다.

#### VPC에서 사용하는 사설 아이피 대역
- `10.0.0.0 ~ 10.255.255.255(10/8 prefix)`
- `172.16.0.0 ~ 172.31.255.255(182.16/12 prefix)`
- `192.168.0.0 ~ 192.168.255.255(192.168/16 prefix)`

## 서브넷
- VPC를 만든 후 VPC를 잘게 쪼개어 서브넷을 만들게됩니다.
- 서브넷은 VPC를 잘게 쪼갠 것이기 때문에 아이피 범위가 더 작은 값을 가지게 되는데 VPC 안에서 서브넷을 나누는 이유는 더 넓은 네트워크망을 만들기 위해서입니다.
- 이러한 서브넷 안에는 EC2나 RDS같은 리소스를 적용할 수 있습니다.

## 라우팅 테이블과 라우터
- 네트워크에 요청이 들어오게되면 라우터로 이동하게 되고, 요청에 대하는 데이터는 라우팅 테이블에 정의된 내용을 토대로 작동합니다.
- 어떠한 서브넷의 라우팅 테이블에 정의되어있는 요청은 로컬에서 이루어지지만 그 외에 다른 네트워크 요청은 처리할 수 없게 되어있는데 이런 경우에 인터넷 게이트웨이(IGA)를 사용합니다.

## 인터넷 게이트웨이(IGA)
- `IGA`는 `VPC`와 인터넷을 연결해주는 역할을 합니다.

만약 라우팅 테이블에 범위가 `0.0.0.0/0`이고, 타겟이 `IGA A`로 정의되어 있는 경우에 모든 트래픽을 `IGA A`로 향하라는 의미인데, 라우팅 테이블에 `0.0.0.0/0`의 주소 외에 다른 구체적인 주소가 있을 경우 라우팅 테이블은 가장 먼저 구체적인 주소와 매칭을 한 후 매칭이 맞지 않는다면 `IGA A`로 보내게됩니다.

인터넷과 연결되어있는 서브넷을 퍼블릭 서브넷이라고 부르고, 연결되어있지 않은 서브넷은 프라이빗 서브넷이라고 부릅니다.

<img width="750" alt="Image" src="https://github.com/user-attachments/assets/aa436d38-a6f4-4deb-8fed-948ef3d1d27c" />

## 네트워크 ACL과 보안 그룹
- 네트워크 ACL과 보안 그룹은 방화벽 역할을 합니다.
### 보안 그룹
- 인바운드 트래픽과 아웃바운드 트래픽을 정하여 보안 정책을 설정할 수 있습니다.
- 보안 그룹은 기본적으로 모든 트래픽을 차단하도록 설정되어있기 때문에 필요한 트래픽 설정을 따로 해주어야합니다. 또한 각각의 EC2 인스턴스와 서브넷에 별도의 보안 그룹을 설정할 수 있습니다.
### 네트워크 ACL
- 네트워크 ACL은 `Stateless`하게 작동하며 모든 트래픽이 기본적으로 허용되어있기 때문에 불필요한 트래픽을 막도록 설정해주어야 합니다.
- 서브넷 단위로 적용되고, 보안 그룹과는 다르게 EC2와 같은 리소스 별로 설정할 수 없습니다.

<img width="750" alt="Image" src="https://github.com/user-attachments/assets/6b3b6c8d-b4a1-4789-ad54-41cd2aa2cc5c" />

## NAT 게이트웨이
- NAT 게이트웨이는 프라이빗 서브넷이 인터넷과 통신을 하기 위한 아웃바운드 인스턴스입니다.
- 프라이빗 네트워크이기 때문에 요청에 대한 인바운드는 필요 없더라도 펌웨어나 주기적인 업데이트가 필요하여 아웃바운드 트래픽을 허용해야하는 경우가 있습니다.
- NAT 게이트웨이는 퍼블릭 서브넷에서 위치하여 프라이빗 서브넷에서 아웃바운드되는 요청을 `IGA`와 연결합니다.

<img width="750" alt="Image" src="https://github.com/user-attachments/assets/6fdf561b-9ff8-4181-b4b8-6680017b9a77" />

## 참고 자료
- https://medium.com/harrythegreat/aws-%EA%B0%80%EC%9E%A5%EC%89%BD%EA%B2%8C-vpc-%EA%B0%9C%EB%85%90%EC%9E%A1%EA%B8%B0-71eef95a7098
- https://inpa.tistory.com/entry/WEB-%F0%9F%8C%90-IP-%EA%B8%B0%EC%B4%88-%EC%82%AC%EC%84%A4IP-%EA%B3%B5%EC%9D%B8IP-NAT-%EA%B0%9C%EB%85%90-%EC%A0%95%EB%A7%90-%EC%89%BD%EA%B2%8C-%EC%A0%95%EB%A6%AC
- https://aws-hyoh.tistory.com/49
