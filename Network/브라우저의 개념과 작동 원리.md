# Internet - 브라우저의 개념과 작동 원리

------

# 브라우저란?

- 웹 브라우저는 동기적으로 (HTML + CSS), JavaScript 언어를 해석하여 내용을 화면에 보여주는 응용 소프트웨어임.

### 동기적인 이유

- 웹 브라우저가 웹 서버에 필요한 자원을 요청하면 서버는 응답하고 웹 브라우저는 이를 해석한 후 클라이언트에게 보여줌.

------

## 브라우저의 구조

1. 사용자 인터페이스

- 사용자가 접근할 수 있는 영역.
- UI를 입력할 수 있는 주소 표시줄, 이전/다음 버튼, 북마크 메뉴 등 요청한 페이지를 보여주는 창을 제외한 나머지 모든 부분.

1. 브라우저 엔진

- 사용자 인터페이스와 렌더링 엔진 사이의 동작을 제어함.
- Data Storage를 참조하며 로컬에 데이터를 쓰고 읽으면서 다양한 작업을 함.

1. 렌더링 엔진

- 웹 서버로부터 응답 받은 웹 페이지를 웹 브라우저 상에 나타냄.
- HTML 문서를 응답받으면 HTML과 CSS를 파싱하여 화면에 표시함.
- 브라우저는 서버로부터 HTML 문서를 응답받으면 렌더링 엔진의 HTML 파서와 CSS 파서에 의해 파싱되어 DOM, CSSOM 트리로 변환되고 렌더 트리로 결합함.
- 생성된 렌더 트리를 기반으로 브라우저는 웹페이지를 나타냄.

1. 통신

- HTTP 요청과 같은, 서버와 통신이 가능하게 하는 네트워크 호출에 사용됨.

1. UI 백엔드

- select, input 등 기본적인 위젯을 그리는 인터페이스임.

1. 자바스크립트 해석기

- 자바스크립트 코드를 해석하고 실행함.

1. 자료 저장소

- Cookie, Local Storage, Indexed DB 등 브라우저 메모리를 활용하여 저장하는 영역.

------

## 렌더링 엔진

- 렌더링 엔진은 HTML, XML, 이미지 등 요청받은 내용을 브라우저 화면에 표시하는 엔진임.
- 각 브라우저마다 렌더링 엔진이 다름.
- Blink - 크롬, 오페라  (Blink는 구글이 Webki을 대체하기 위해 자체적으로 개발한 엔진임.)
- Webki - 사파리
- Trident - 익스플로어
- EdgeHTML - 마이크로소프트 엣지
- HTML을 파싱 할 때가지 기다리지 않고 렌더 트리 배치와 그리기 과정을 시작함.

------

## 렌더링 엔진 동작 과정

- 렌더링 엔진은 서버로부터 응답받은 HTML 문서를 얻는 것으로 시작함.

DOM 트리 구축 위한 HTML 파싱 ⇒ 렌더 트리 구축 ⇒ 렌더 트리 배치 ⇒ 렌더 트리 그리기

1. 렌더링 엔진은 HTML 문서를 파싱 하여 DOM 트리를 구축함.
2. 외부 CSS 파일과 함께 포함된 스타일 요소를 파싱함.
3. DOM 트리와 2의 결과물을 합쳐 렌더 트리를 구축함.
4. 렌더 트리 각 노드에 대해 화면 상에서 배치할 곳을 결정함.
5. UI 백엔드에서 렌더 트리의 각 노드를 그림.

------

### 1. HTML 문서를 파싱하여 DOM 트리를 구축함.

- 브라우저는 서버로부터 HTML 문서를 모두 전달받고 HTML 파서를 통하여 파싱하고 파싱 트리를 생성함.
- 생성된 파싱 트리를 기반으로 DOM 트리를 생성함.

------

### 2. CSSOM을 생성함.

- CSS 파일은 스타일 시트 객체로 파싱되고 각 객체는 CSS 규칙을 포함함.
- CSS 규칙 객체(CSSOM)는 선택자와 선언 객체 그리고 CSS 문법과 일치하는 다른 객체를 포함함.

------

### 3. 렌더 트리(DOM + CSSOM)를 생성함.

- DOM 트리가 구축되는 동안 브라우저는 DOM 트리를 기반으로 렌더 트리를 생성함.
- 렌더 트리는 문서를 시작적인 구성 요소로 만들어주는 역할을 함.
- 웹킷은 이 구성 요소를 렌더러(rendere) 또는 렌더 객체(render object)라는 용어를 사용함.
- 렌더러는 자신과 자식 요소를 어떻게 배치하고 그려내야 하는지 알고 있음.
- 렌더러는 DOM 요소에 부합하지만 1:1로 대응하는 관계는 아님. 왜냐하면 <head>,display: ‘none’과 같은 사용자가 볼 수 없는 DOM 요소는 렌더 트리에 추가되지 않음.

------

### 4. 렌더 트리를 배치함. (레이아웃)

- 렌더 트리는 위치와 크기를 가지고 있지 않기 때문에 어느 공간에 위치해야 할지 각 객체들에게 위치(position)와 크기(size)를 결정해줌.

------

### 5. 렌더 트리를 그림.

- 렌더 트리가 만들어져 레이아웃이 구성되었으면 UI 백엔드가 동작하여 렌더 트리의 각 객체를 화면의 픽셀 값으로 나타냄.

------

## 자바스크립트는?

- 자바스크립트는 렌더링 엔진에서 처리되지 않고 자바스크립트 엔진에서 처리됨.
- HTML 파서는 <script>태그를 만나면 JavaScript 코드를 실행하기 위해 DOM 생성 프로세르를 중지하고 자바스크립트 엔진으로 권한을 넘김.
- 제어 권한을 넘겨받은 자바스크립트 엔진은 <script>태그 내의 JavaScript 코드 또는 src 속성에 정의된 JavaScript 파일을 로드하고 파싱하여 실행함.
- JavaScript의 실행이 완료되면 다시 HTML 파서로 제어 권한을 넘겨서 중지했던 시점으로 돌아가 DOM 생성을 재개함.

------

## 참고 자료

- https://bbangson.tistory.com/87

------